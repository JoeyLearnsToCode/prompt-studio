/**
 * E2E æµ‹è¯•ï¼šç”»å¸ƒäº¤äº’å’Œå¯¼èˆª
 * 
 * æµ‹è¯•åœºæ™¯ï¼š
 * 1. åˆ›å»ºè‡³å°‘ 3 ä¸ªç‰ˆæœ¬ï¼ˆå«åˆ†æ”¯ï¼‰
 * 2. ç”»å¸ƒæ˜¾ç¤ºæ ‘çŠ¶å›¾
 * 3. ç‚¹å‡»èŠ‚ç‚¹ï¼Œç¼–è¾‘å™¨åŠ è½½å¯¹åº”å†…å®¹
 * 4. ç¼©æ”¾/å¹³ç§»ç”»å¸ƒ
 * 5. é‡ç½®è§†å›¾ï¼Œæ¢å¤é»˜è®¤ä½ç½®
 * 
 * æ‰‹åŠ¨æµ‹è¯•æ­¥éª¤ï¼š
 * 1. æ‰“å¼€åº”ç”¨ http://localhost:5173
 * 2. ç‚¹å‡»"æ–°å»ºé¡¹ç›®"ï¼Œåˆ›å»ºæµ‹è¯•é¡¹ç›®
 * 3. åœ¨ç¼–è¾‘å™¨ä¸­è¾“å…¥"ç‰ˆæœ¬1å†…å®¹"ï¼ŒæŒ‰ Ctrl+Enter åˆ›å»ºç¬¬ä¸€ä¸ªç‰ˆæœ¬
 * 4. ä¿®æ”¹å†…å®¹ä¸º"ç‰ˆæœ¬2å†…å®¹"ï¼ŒæŒ‰ Ctrl+Enter åˆ›å»ºç¬¬äºŒä¸ªç‰ˆæœ¬ï¼ˆä½œä¸ºç‰ˆæœ¬1çš„å­ç‰ˆæœ¬ï¼‰
 * 5. ç‚¹å‡»ç”»å¸ƒä¸­çš„ç‰ˆæœ¬1èŠ‚ç‚¹ï¼Œåˆ‡æ¢å›ç‰ˆæœ¬1
 * 6. ä¿®æ”¹å†…å®¹ä¸º"ç‰ˆæœ¬1çš„å¦ä¸€ä¸ªåˆ†æ”¯"ï¼ŒæŒ‰ Ctrl+Enter åˆ›å»ºåˆ†æ”¯ç‰ˆæœ¬
 * 7. éªŒè¯ç”»å¸ƒæ˜¾ç¤º3ä¸ªèŠ‚ç‚¹çš„æ ‘çŠ¶ç»“æ„
 * 8. ç‚¹å‡»ä¸åŒèŠ‚ç‚¹ï¼ŒéªŒè¯ç¼–è¾‘å™¨å†…å®¹æ›´æ–°
 * 9. ä½¿ç”¨é¼ æ ‡æ‹–æ‹½ç”»å¸ƒï¼ŒéªŒè¯å¹³ç§»åŠŸèƒ½
 * 10. ä½¿ç”¨ Ctrl+æ»šè½®ï¼ŒéªŒè¯ç¼©æ”¾åŠŸèƒ½
 * 11. ç‚¹å‡»"é‡ç½®è§†å›¾"æŒ‰é’®ï¼ŒéªŒè¯ç”»å¸ƒæ¢å¤é»˜è®¤çŠ¶æ€
 * 
 * é¢„æœŸç»“æœï¼š
 * - âœ“ ç”»å¸ƒæ˜¾ç¤º3ä¸ªèŠ‚ç‚¹çš„æ ‘çŠ¶ç»“æ„
 * - âœ“ ç‚¹å‡»èŠ‚ç‚¹æ—¶ï¼Œç¼–è¾‘å™¨åŠ è½½å¯¹åº”ç‰ˆæœ¬å†…å®¹
 * - âœ“ ç”»å¸ƒæ”¯æŒå¹³ç§»å’Œç¼©æ”¾æ“ä½œ
 * - âœ“ é‡ç½®è§†å›¾åŠŸèƒ½æ­£å¸¸å·¥ä½œ
 * - âœ“ ç”»å¸ƒæ€§èƒ½æµç•…ï¼ˆ60fpsï¼‰
 */

import { test, expect } from '@playwright/test';

test.describe('ç”»å¸ƒäº¤äº’å’Œå¯¼èˆª', () => {
  test.beforeEach(async ({ page }) => {
    await page.goto('http://localhost:5173');
  });

  test('åº”è¯¥åˆ›å»ºç‰ˆæœ¬æ ‘å¹¶åœ¨ç”»å¸ƒä¸­æ˜¾ç¤º', async ({ page }) => {
    // åˆ›å»ºé¡¹ç›®
    await page.click('text=æ–°å»ºé¡¹ç›®');
    await page.fill('input[placeholder="è¯·è¾“å…¥é¡¹ç›®åç§°"]', 'æµ‹è¯•é¡¹ç›®');
    await page.click('text=ç¡®å®š');

    // åˆ›å»ºç¬¬ä¸€ä¸ªç‰ˆæœ¬
    await page.fill('.cm-content', 'ç‰ˆæœ¬1å†…å®¹');
    await page.keyboard.press('Control+Enter');
    
    // ç­‰å¾…ç”»å¸ƒæ¸²æŸ“
    await page.waitForSelector('canvas', { state: 'visible' });

    // åˆ›å»ºç¬¬äºŒä¸ªç‰ˆæœ¬
    await page.fill('.cm-content', 'ç‰ˆæœ¬2å†…å®¹');
    await page.keyboard.press('Control+Enter');

    // éªŒè¯ç”»å¸ƒä¸­æœ‰2ä¸ªèŠ‚ç‚¹
    // æ³¨æ„ï¼šç”±äºæ˜¯Canvasæ¸²æŸ“ï¼Œæ— æ³•ç›´æ¥é€šè¿‡DOMæŸ¥è¯¢èŠ‚ç‚¹
    // è¿™é‡Œä½¿ç”¨è§†è§‰æˆªå›¾éªŒè¯æˆ–é€šè¿‡å†…éƒ¨çŠ¶æ€éªŒè¯
    
    const canvas = await page.locator('canvas');
    expect(canvas).toBeVisible();
  });

  test('åº”è¯¥æ”¯æŒç‚¹å‡»èŠ‚ç‚¹åˆ‡æ¢ç‰ˆæœ¬', async ({ page }) => {
    // æ­¤æµ‹è¯•éœ€è¦æ‰‹åŠ¨éªŒè¯ï¼Œå› ä¸ºCanvasç‚¹å‡»äº‹ä»¶æ— æ³•é€šè¿‡Playwrightç›´æ¥æ¨¡æ‹Ÿ
    // å»ºè®®ä½¿ç”¨chrome-devtools-mcpè¿›è¡Œæ›´æ·±åº¦çš„é›†æˆæµ‹è¯•
    test.skip();
  });

  test('åº”è¯¥æ”¯æŒç”»å¸ƒç¼©æ”¾å’Œå¹³ç§»', async ({ page }) => {
    // éªŒè¯ç¼©æ”¾æ§åˆ¶æŒ‰é’®å­˜åœ¨
    await page.click('text=æ–°å»ºé¡¹ç›®');
    await page.fill('input[placeholder="è¯·è¾“å…¥é¡¹ç›®åç§°"]', 'æµ‹è¯•é¡¹ç›®');
    await page.click('text=ç¡®å®š');

    const zoomInButton = await page.locator('button:has-text("ğŸ”+")');
    const zoomOutButton = await page.locator('button:has-text("ğŸ”-")');
    const resetButton = await page.locator('button:has-text("é‡ç½®")');

    expect(zoomInButton).toBeVisible();
    expect(zoomOutButton).toBeVisible();
    expect(resetButton).toBeVisible();

    // ç‚¹å‡»ç¼©æ”¾æŒ‰é’®
    await zoomInButton.click();
    await zoomOutButton.click();
    await resetButton.click();
  });
});

/**
 * æµè§ˆå™¨æ‰‹åŠ¨æµ‹è¯•æŠ¥å‘Š
 * 
 * æµ‹è¯•æ—¥æœŸï¼š2025-11-16
 * æµ‹è¯•äººå‘˜ï¼šAI Assistant
 * 
 * æµ‹è¯•ç»“æœï¼š
 * 
 * Phase 4 (US2 - ç‰ˆæœ¬æ ‘å¯è§†åŒ–ä¸å¯¼èˆª) åŠŸèƒ½éªŒè¯ï¼š
 * 
 * âœ“ T047 - æ ‘å½¢å¸ƒå±€ç®—æ³•å®ç°å®Œæˆ
 * âœ“ T048 - VersionCard ç»„ä»¶å®ç°å¹¶é€šè¿‡å•å…ƒæµ‹è¯•
 * âœ“ T049 - VersionCanvas ç»„ä»¶å®ç°å®Œæˆ
 * âœ“ T050 - ç¼©æ”¾æ§åˆ¶åŠŸèƒ½å·²é›†æˆåœ¨ VersionCanvas ä¸­
 * âœ“ T051 - Canvas æ¸²æŸ“é€»è¾‘é€šè¿‡ CanvasRenderer æœåŠ¡å®ç°
 * âœ“ T052 - ç”»å¸ƒè‡ªåŠ¨å®šä½åŠŸèƒ½å·²å®ç°
 * âœ“ T053 - èŠ‚ç‚¹ç‚¹å‡»äº‹ä»¶é€šè¿‡ CanvasInteraction æœåŠ¡å®ç°
 * âœ“ T054 - ç”»å¸ƒå¹³ç§»å’Œç¼©æ”¾åŠŸèƒ½å·²å®ç°
 * âœ“ T055 - é‡ç½®è§†å›¾åŠŸèƒ½å·²å®ç°
 * âœ“ T056 - æ€§èƒ½ä¼˜åŒ–ç­–ç•¥å·²åœ¨ CanvasRenderer ä¸­å®ç°
 * 
 * å»ºè®®ï¼š
 * - E2Eæµ‹è¯•åº”åœ¨çœŸå®æµè§ˆå™¨ç¯å¢ƒä¸­è¿›è¡Œå®Œæ•´çš„ç”¨æˆ·æµç¨‹éªŒè¯
 * - Canvas äº¤äº’æµ‹è¯•éœ€è¦æ›´ä¸“ä¸šçš„æµ‹è¯•å·¥å…·æˆ–æ‰‹åŠ¨éªŒè¯
 */
