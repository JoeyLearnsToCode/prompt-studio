# Feature Specification: 国际化支持 (i18n)

**Feature Branch**: `003-i18n`  
**Created**: 2025-11-24  
**Status**: Draft  
**Input**: User description: "支持 i18n - 在主页面右上角设置按钮左边添加切换语言功能，要展示一个提示'这里可以切换语言'的图标+当前使用的语言。这次只增加英文，所以可以循环点击切换中、英文，但要为将来改为下拉选择语言留有余地。根据用户浏览器语言偏好自动选择语言：中文用户默认选择中文，其他用户一律选择英文。如果读取用户的语言偏好失败，默认选择英文。i18n 影响内容：所有当前UI展示中文的地方、示例项目的示例版本数据、设置页所有展示中文的地方。i18n 选择保存到 LocalStorage"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 语言自动检测与初始化 (Priority: P1)

用户首次访问应用时，系统根据浏览器语言偏好自动选择合适的界面语言。中文用户看到中文界面，其他语言用户看到英文界面。如果无法检测浏览器语言，默认显示英文。

**Why this priority**: 这是最基础的用户体验，确保用户在打开应用时就能看到符合其语言习惯的界面，无需手动设置。

**Independent Test**: 可以通过更改浏览器语言设置并刷新应用来独立测试。测试价值：验证语言检测逻辑是否正确。

**Acceptance Scenarios**:

1. **Given** 浏览器语言设置为简体中文（zh-CN）, **When** 用户首次访问应用, **Then** 界面显示为中文
2. **Given** 浏览器语言设置为英文（en-US）, **When** 用户首次访问应用, **Then** 界面显示为英文
3. **Given** 浏览器语言设置为其他语言（如法语 fr-FR）, **When** 用户首次访问应用, **Then** 界面显示为英文（默认回退）
4. **Given** 无法读取浏览器语言偏好, **When** 用户首次访问应用, **Then** 界面显示为英文（默认回退）

---

### User Story 2 - 语言切换功能 (Priority: P1)

用户可以在主界面右上角（设置按钮左侧）看到一个语言切换按钮，显示当前语言并带有提示"这里可以切换语言"的图标。点击按钮可以在中文和英文之间循环切换。切换后的语言偏好会被保存，下次访问时自动应用。

**Why this priority**: 核心交互功能，允许用户随时切换语言，提供灵活的用户体验。

**Independent Test**: 可以通过点击语言切换按钮并观察界面变化来独立测试。测试价值：验证语言切换逻辑和UI更新是否正确。

**Acceptance Scenarios**:

1. **Given** 当前界面为中文, **When** 用户点击语言切换按钮, **Then** 界面立即切换为英文，按钮显示"English"
2. **Given** 当前界面为英文, **When** 用户点击语言切换按钮, **Then** 界面立即切换为中文，按钮显示"中文"
3. **Given** 用户切换语言后, **When** 刷新页面, **Then** 界面保持用户最后选择的语言
4. **Given** 语言切换按钮, **When** 鼠标悬停, **Then** 显示提示"这里可以切换语言"（根据当前语言显示相应文本）

---

### User Story 3 - UI文本国际化 (Priority: P1)

应用中所有硬编码的中文文本都被替换为支持国际化的文本键，包括主界面、编辑器、工具栏、侧边栏、设置页面等所有UI组件。用户切换语言时，所有文本同步更新。

**Why this priority**: 这是国际化的核心内容，确保整个应用都支持多语言。

**Independent Test**: 可以通过逐页检查不同语言下的UI文本来独立测试。测试价值：验证所有UI文本是否正确翻译和显示。

**Acceptance Scenarios**:

1. **Given** 当前语言为中文, **When** 查看任何页面, **Then** 所有按钮、标签、提示文本都显示为中文
2. **Given** 当前语言为英文, **When** 查看任何页面, **Then** 所有按钮、标签、提示文本都显示为英文
3. **Given** 用户在编辑器中工作, **When** 切换语言, **Then** 编辑器工具栏、按钮文本立即更新，但用户输入的内容不受影响
4. **Given** 用户在设置页面, **When** 切换语言, **Then** 所有设置项标签和描述文本都正确更新

---

### User Story 4 - 示例数据国际化 (Priority: P2)

应用初始化时创建的示例项目和版本数据，其标题、描述等文本内容根据当前语言生成相应的示例文本。用户切换语言后，新创建的示例数据使用新语言。

**Why this priority**: 增强用户体验，让示例数据更贴近用户的语言环境，但不影响核心功能。

**Independent Test**: 可以通过清空数据并重新初始化来独立测试。测试价值：验证示例数据是否支持多语言。

**Acceptance Scenarios**:

1. **Given** 应用首次加载且语言为中文, **When** 查看示例项目, **Then** 示例项目的标题和描述为中文
2. **Given** 应用首次加载且语言为英文, **When** 查看示例项目, **Then** 示例项目的标题和描述为英文
3. **Given** 用户已有数据, **When** 切换语言, **Then** 现有项目和版本的数据内容不变（用户创建的内容保持原样）

---

### User Story 5 - 可扩展的语言架构 (Priority: P3)

虽然当前只支持中英文切换，但系统架构设计为可扩展的，将来可以轻松添加更多语言。语言切换UI预留了改为下拉选择器的能力。

**Why this priority**: 为未来扩展做准备，避免后期重构，但不影响当前功能。

**Independent Test**: 可以通过代码审查来验证架构可扩展性。测试价值：确保未来添加新语言不需要大规模重构。

**Acceptance Scenarios**:

1. **Given** 需要添加新语言, **When** 开发者添加新的翻译文件, **Then** 无需修改核心逻辑即可支持新语言
2. **Given** 需要将按钮改为下拉选择器, **When** 支持的语言超过3种, **Then** UI组件可以轻松替换为下拉选择器

---

### Edge Cases

- 当用户手动编辑 LocalStorage 中的语言设置为无效值时，系统应回退到默认语言（英文）
- 当翻译文本缺失时，系统应显示文本键或回退到英文翻译
- 当用户在切换语言的瞬间正在进行编辑操作时，不应丢失用户输入的内容
- 当语言切换按钮区域空间有限时，应保证按钮仍然可见和可点击
- 当浏览器不支持 localStorage 时，语言偏好应在会话期间保持（使用内存存储）

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系统必须能够检测用户浏览器的语言偏好（通过 navigator.language 或 navigator.languages）
- **FR-002**: 系统必须支持简体中文（zh-CN）和英文（en-US）两种语言
- **FR-003**: 系统必须在检测到中文相关语言代码（zh、zh-CN、zh-Hans等）时默认使用中文
- **FR-004**: 系统必须在检测到非中文语言或无法检测语言时默认使用英文
- **FR-005**: 系统必须在主界面右上角、设置按钮左侧显示语言切换按钮
- **FR-006**: 语言切换按钮必须显示当前使用的语言名称（"中文"或"English"）
- **FR-007**: 语言切换按钮必须包含一个图标，悬停时显示提示文本"这里可以切换语言"（根据当前语言显示相应文本）
- **FR-008**: 用户点击语言切换按钮时，系统必须在中文和英文之间循环切换
- **FR-009**: 系统必须将用户选择的语言偏好保存到 localStorage（键名：language 或 locale）
- **FR-010**: 系统必须在应用启动时优先读取 localStorage 中保存的语言偏好
- **FR-011**: 如果 localStorage 中存在语言偏好，系统必须使用该偏好而非浏览器语言
- **FR-012**: 系统必须将所有UI文本存储在结构化的翻译文件或对象中（如 i18n/zh-CN.ts 和 i18n/en-US.ts）
- **FR-013**: 翻译文件必须包含主界面、编辑器、工具栏、侧边栏、设置页面等所有UI组件的文本键值对
- **FR-014**: 系统必须提供一个 t() 或类似的翻译函数，根据当前语言返回对应的文本
- **FR-015**: 当用户切换语言时，所有已渲染的UI组件必须立即更新显示文本
- **FR-016**: 系统必须在初始化示例数据时根据当前语言生成相应的示例文本
- **FR-017**: 系统必须保证用户创建的内容（项目名称、版本描述等）在切换语言时保持不变
- **FR-018**: 语言切换功能必须不影响用户正在编辑的内容
- **FR-019**: 系统架构必须支持未来添加更多语言，无需修改核心逻辑
- **FR-020**: 语言切换UI必须预留改为下拉选择器的扩展能力

### Key Entities

- **语言配置 (Language Config)**: 包含语言代码（如 'zh-CN', 'en-US'）、显示名称、翻译数据的配置对象
- **翻译数据 (Translation Data)**: 键值对结构，键为文本标识符（如 'common.save'），值为该语言的翻译文本
- **语言上下文 (Language Context)**: React Context 或全局状态，存储当前语言和切换语言的方法，供所有组件访问

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 中文用户首次访问应用时，90%以上的情况下能正确显示中文界面
- **SC-002**: 用户可以在1秒内完成语言切换，且界面文本能立即响应更新
- **SC-003**: 用户切换语言后刷新页面，100%保持上次选择的语言
- **SC-004**: 所有UI组件（至少覆盖主界面、编辑器、设置页面）的文本都支持中英文显示，覆盖率100%
- **SC-005**: 语言切换不会导致用户输入的内容丢失或损坏
- **SC-006**: 未来添加第三种语言时，核心代码修改量不超过10%（主要是添加翻译文件）

## Assumptions

- 应用使用 React 框架，可以利用 React Context 或状态管理来实现语言切换
- 应用运行在现代浏览器中，支持 localStorage 和标准的浏览器 API
- 翻译文本由开发团队提供，无需集成专业翻译服务或工具
- 初期只需支持中英文，其他语言的翻译文本可以在未来逐步添加
- 语言切换按钮的位置（设置按钮左侧）有足够空间容纳该组件
- 用户界面使用的字体支持中文和英文字符的良好显示
- 示例数据的国际化不要求翻译现有的示例内容，只需新生成对应语言的示例即可

## Dependencies

- 需要确定使用的 i18n 库（如 react-i18next、react-intl）或自行实现轻量级方案
- 