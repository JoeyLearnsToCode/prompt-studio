<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>测试 - Prompt Studio</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: #fdfcf5;
    }
    .test-section {
      margin: 20px 0;
      padding: 15px;
      border: 2px solid #a8c548;
      border-radius: 8px;
      background: white;
    }
    h2 {
      color: #1a2400;
      margin-top: 0;
    }
    .test-button {
      background: #a8c548;
      color: #1a2400;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      margin: 5px;
    }
    .test-button:hover {
      background: #96b23a;
    }
    .result {
      margin-top: 10px;
      padding: 10px;
      background: #e4e3d6;
      border-radius: 4px;
      font-family: monospace;
      white-space: pre-wrap;
    }
    .success { color: #2a4a1f; background: #b8e3a9; }
    .error { color: #410002; background: #ffdad6; }
  </style>
</head>
<body>
  <h1>Prompt Studio 手动测试</h1>
  
  <div class="test-section">
    <h2>1. 文本标准化测试</h2>
    <button class="test-button" onclick="testNormalize()">测试 normalize()</button>
    <div id="normalize-result" class="result"></div>
  </div>

  <div class="test-section">
    <h2>2. 颜色对比度测试</h2>
    <p>测试按钮颜色对比度（应该清晰可见）：</p>
    <button class="test-button">主按钮 - 应该清晰</button>
    <button class="test-button" style="border: 2px solid #a8c548; background: transparent; color: #a8c548;">边框按钮</button>
    <button class="test-button" disabled style="opacity: 0.5;">禁用按钮</button>
  </div>

  <div class="test-section">
    <h2>3. 数据库操作测试</h2>
    <button class="test-button" onclick="testDatabase()">创建测试项目</button>
    <button class="test-button" onclick="checkDatabase()">检查数据库</button>
    <div id="db-result" class="result"></div>
  </div>

  <div class="test-section">
    <h2>4. 打开主应用</h2>
    <a href="http://localhost:5173" target="_blank" class="test-button" style="display: inline-block; text-decoration: none;">打开 Prompt Studio</a>
  </div>

  <script type="module">
    // 测试标准化函数
    window.testNormalize = function() {
      const testCases = [
        { input: 'Hello, World!', expected: 'helloworld' },
        { input: '你好，世界！', expected: '你好世界' },
        { input: 'Test  (with)  [brackets]', expected: 'testwithbrackets' },
        { input: 'Line1\\n\\nLine2', expected: 'line1line2' },
      ];

      function normalize(text) {
        return text
          .toLowerCase()
          .replace(/[\s\u0000-\u001F\u007F-\u009F\u00A0\u1680\u180E\u2000-\u200B\u202F\u205F\u3000\uFEFF]/g, '')
          .replace(/[,.\-\-，。/\\()\[\]{}、（）【】|@；;""]/g, '')
          .trim();
      }

      let results = [];
      testCases.forEach(({ input, expected }, i) => {
        const actual = normalize(input);
        const pass = actual === expected;
        results.push(`测试 ${i + 1}: ${pass ? '✅ 通过' : '❌ 失败'}`);
        results.push(`  输入: "${input}"`);
        results.push(`  期望: "${expected}"`);
        results.push(`  实际: "${actual}"`);
        results.push('');
      });

      const resultDiv = document.getElementById('normalize-result');
      resultDiv.textContent = results.join('\\n');
      resultDiv.className = 'result success';
    };

    // 测试数据库
    window.testDatabase = async function() {
      const resultDiv = document.getElementById('db-result');
      try {
        resultDiv.textContent = '正在创建测试项目...';
        
        // 动态导入 Dexie
        const { default: Dexie } = await import('https://cdn.jsdelivr.net/npm/dexie@3/dist/dexie.mjs');
        
        // 连接数据库
        const db = new Dexie('prompt-studio');
        db.version(1).stores({
          projects: 'id, folderId, name, createdAt, updatedAt',
          versions: 'id, projectId, parentId, createdAt, contentHash',
          folders: 'id, parentId, name, createdAt'
        });

        // 创建测试项目
        const projectId = crypto.randomUUID();
        const versionId = crypto.randomUUID();
        
        await db.projects.add({
          id: projectId,
          folderId: 'root',
          name: '测试项目-' + Date.now(),
          createdAt: Date.now(),
          updatedAt: Date.now()
        });

        await db.versions.add({
          id: versionId,
          projectId: projectId,
          parentId: null,
          createdAt: Date.now(),
          updatedAt: Date.now(),
          content: '这是测试内容',
          normalizedContent: '这是测试内容',
          contentHash: '123456'
        });

        resultDiv.textContent = `✅ 成功创建测试项目！\\n项目ID: ${projectId}\\n版本ID: ${versionId}`;
        resultDiv.className = 'result success';
      } catch (error) {
        resultDiv.textContent = `❌ 错误: ${error.message}`;
        resultDiv.className = 'result error';
      }
    };

    window.checkDatabase = async function() {
      const resultDiv = document.getElementById('db-result');
      try {
        const { default: Dexie } = await import('https://cdn.jsdelivr.net/npm/dexie@3/dist/dexie.mjs');
        
        const db = new Dexie('prompt-studio');
        db.version(1).stores({
          projects: 'id, folderId, name, createdAt, updatedAt',
          versions: 'id, projectId, parentId, createdAt, contentHash',
          folders: 'id, parentId, name, createdAt'
        });

        const projects = await db.projects.toArray();
        const versions = await db.versions.toArray();
        const folders = await db.folders.toArray();

        resultDiv.textContent = `数据库状态:\\n- 项目数: ${projects.length}\\n- 版本数: ${versions.length}\\n- 文件夹数: ${folders.length}\\n\\n项目列表:\\n${projects.map(p => `  - ${p.name} (ID: ${p.id})`).join('\\n')}`;
        resultDiv.className = 'result success';
      } catch (error) {
        resultDiv.textContent = `❌ 错误: ${error.message}`;
        resultDiv.className = 'result error';
      }
    };
  </script>
</body>
</html>
